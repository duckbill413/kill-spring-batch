# Spring Batch Listener ì™€ í™œìš©

## JobExecutionListener

- Job ì‹¤í–‰ì˜ ì‹œì‘ê³¼ ì¢…ë£Œ ì‹œì ì— í˜¸ì¶œë˜ëŠ” ë¦¬ìŠ¤ë„ˆ ì¸í„°í˜ì´ìŠ¤ë‹¤.
- Job ì‹¤í–‰ ê²°ê³¼ë¥¼ ì´ë©”ì¼ë¡œ ì „ì†¡í•˜ê±°ë‚˜, Job ì´ ì‹œì‘í•˜ê¸° ì „ì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì¤€ë¹„í•˜ê³  ëë‚œ í›„ì— ì •ë¦¬í•˜ëŠ” ë¶€ê°€ ì‘ì—…ì„ ìˆ˜í–‰

**afterJob()** ë©”ì„œë“œëŠ” ì¡ ì‹¤í–‰ ì •ë³´ê°€ ë©”íƒ€ë°ì´í„° ì €ì¥ì†Œì— ì €ì¥ë˜ê¸° ì „ì— í˜¸ì¶œëœë‹¤.  
ì´ë¥¼ í™œìš©í•˜ë©´ íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ Job ì˜ ì‹¤í–‰ ê²°ê³¼ ìƒíƒœë¥¼ ì™„ë£Œ(`COMPLETED`) ì—ì„œ ì‹¤íŒ¨ (`FAILED`)ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```java
public interface JobExecutionListener {
  default void beforeJob(JobExecution jobExecution);

  default void afterJob(JobExecution jobExecution);
}
```

## StepExecutionListener

- Step ì‹¤í–‰ê³¼ ì¢…ë£Œì‹œì ì— í˜¸ì¶œë˜ëŠ” ë¦¬ìŠ¤ë„ˆ ì¸í„°í˜ì´ìŠ¤

```java
public interface StepExecutionListener extends StepListener {
  default void beforeStep(StepExecution stepExecution) {
  }

  @Nullable
  default ExitStatus afterStep(StepExecution stepExecution) {
    return null;
  }
}
```

- `afterStep` ë©”ì„œë“œë¥¼ ë³´ë©´ ExitStatus ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆëŠ”ë°, ì´ë¥¼ í†µí•´ afterStep() ì—ì„œ íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ Step ì˜ ì‹¤í–‰ ê²°ê³¼ ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

## ChunkListener

- ChunkListener ëŠ” í•˜ë‚˜ì˜ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬ê°€ ì‹œì‘ë˜ê¸° ì „, ì™„ë£Œëœ í›„, ê·¸ë¦¬ê³  ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” ë¦¬ìŠ¤ë„ˆ ì¸í„°í˜ì´ìŠ¤

```java
public interface ChunkListener extends StepListener {
  default void beforeChunk(ChunkContext context) {
  }

  default void afterChunk(ChunkContext context) {
  }

  default void afterChunkError(ChunkContext context) {
  }
}
```

- `afterChunk` ëŠ” íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœ í›„ì— í˜¸ì¶œëœë‹¤.
- ë°˜ë©´ ì²­í¬ ì²˜ë¦¬ ë„ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° `afterChunkError` ê°€ í˜¸ì¶œë˜ëŠ”ë°, ì´ëŠ” ì²­í¬ íŠ¸ëœì­ì…˜ì´ **ë¡¤ë°±**ëœ ì´í›„ì— í˜¸ì¶œëœë‹¤.

## Item[Read|Process|Write]Listener

- Item[Read|Process|Write]Listener ëŠ” ì•„ì´í…œì˜ ì½ê¸°/ì²˜ë¦¬/ì“°ê¸° ì‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ” ì‹œì ì— í˜¸ì¶œë˜ëŠ” ë¦¬ìŠ¤ë„ˆ ì¸í„°í˜ì´ìŠ¤ ì´ë‹¤.
- ì•„ì´í…œ ë‹¨ìœ„ì˜ ì²˜ë¦¬ ì „í›„ì™€ ì—ëŸ¬ ë°œìƒ ì‹œì ì— í˜¸ì¶œëœë‹¤.

```java
// ItemReadListener.java
public interface ItemReadListener<T> extends StepListener {
  default void beforeRead() {
  }

  default void afterRead(T item) {
  }

  default void onReadError(Exception ex) {
  }
}

// ItemProcessListener.java
public interface ItemProcessListener<T, S> extends StepListener {
  default void beforeProcess(T item) {
  }

  default void afterProcess(T item, @Nullable S result) {
  }

  default void onProcessError(T item, Exception e) {
  }
}

// ItemWriteListener.java
public interface ItemWriteListener<S> extends StepListener {
  default void beforeWrite(Chunk<? extends S> items) {
  }

  default void afterWrite(Chunk<? extends S> items) {
  }

  default void onWriteError(Exception exception, Chunk<? extends S> items) {
  }
}
```

- `ItemReadListener.afterRead()` ëŠ” ItemReader.read() í˜¸ì¶œ í›„ì— í˜¸ì¶œë˜ì§€ë§Œ, ItemReader.read() ë©”ì„œë“œê°€ ë” ì´ìƒ ì½ì„ ë°ì´í„°ê°€ ì—†ì–´ `null` ì„ ë°˜í™˜í•  ë•ŒëŠ”
  í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- ë°˜ë©´, `ItemProcessListener.afterProcess()` ëŠ” ItemProcessor.process() ë©”ì„œë“œê°€ `null` ì„ ë°˜í™˜í•˜ë”ë¼ë„ í˜¸ì¶œëœë‹¤. ì°¸ê³ ë¡œ ItemProcessor ì—ì„œ
  `null` ì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í•´ë‹¹ ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
- `ItemWriteListener.afterWrite()` ëŠ” íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ê¸° ì „, ê·¸ë¦¬ê³  ChunkListener.afterChunk() ê°€ í˜¸ì¶œë˜ê¸° ì „ì— í˜¸ì¶œëœë‹¤.

![img.png](../../../../../../../../assets/images/ItemListener1.png)

> **ë°°ì¹˜ ë¦¬ìŠ¤ë„ˆ**, ì´ëŸ° ê²ƒë“¤ì„ í•  ìˆ˜ ìˆë‹¤.
> - **ë‹¨ê³„ë³„ ëª¨ë‹ˆí„°ë§ê³¼ ì¶”ì **: ë°°ì¹˜ ì‘ì—…ì˜ ëª¨ë“  ë‹¨ê³„ë¥¼ ë‚´ ì†ì•„ê·€ì— ë„£ì„ ìˆ˜ ìˆë‹¤. ê° Jobê³¼ Stepì˜ ì‹¤í–‰ ì „í›„ì— ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤. Step ì´ ì–¸ì œ ì‹œì‘í•˜ê³ , ì–¸ì œ ëë‚¬ëŠ”ì§€, ëª‡ ê°œì˜ ë°ì´í„°ë¥¼
    ì²˜ë¦¬í–ˆëŠ”ì§€ë„ ëª¨ë“  ê²ƒì„ ê¸°ë¡í•˜ê³  ì¶”ì í•  ìˆ˜ ìˆë‹¤.
> - **ì‹¤í–‰ ê²°ê³¼ì— ë”°ë¥¸ í›„ì† ì²˜ë¦¬**: Jobê³¼ Stepì˜ ì‹¤í–‰ ìƒíƒœë¥¼ ë¦¬ìŠ¤ë„ˆì—ì„œ ì§ì ‘í™•ì¸í•˜ê³  ì¡°ì¹˜ë¥¼ í•  ìˆ˜ ìˆë‹¤. JobExecutionListener ì˜ afterJob() ë©”ì„œë“œì—ì„œ Jobì˜ ì¢…ë£Œ ìƒíƒœë¥¼
    í™•ì¸í•˜ê³  í›„ì† ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆë‹¤.
> - **ë°ì´í„° ê°€ê³µê³¼ ì „ë‹¬**: ì‹¤ì œ ì²˜ë¦¬ ë¡œì§ ì „í›„ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³  ì •ì œí•˜ê±°ë‚˜ ë³€í™˜í•  ìˆ˜ ìˆë‹¤. StepExecutionListener ë‚˜ ChunkListener ë¥¼ ì‚¬ìš©í•˜ë©´ ExecutionContext
    ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ í•„ìš”í•œ ì •ë³´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ Step ê°„ì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê±°ë‚˜, ë‹¤ìŒ ì²˜ë¦¬ì— í•„ìš”í•œ ì •ë³´ë¥¼ ë¯¸ë¦¬ ì¤€ë¹„í•  ìˆ˜ ìˆë‹¤.
> - **ë¶€ê°€ ê¸°ëŠ¥ ë¶„ë¦¬**: ì£¼ìš” ì²˜ë¦¬ ë¡œì§ê³¼ ë¶€ê°€ ë¡œì§ì„ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤. ê°€ë ¹ ChunkListener ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš° afterChunkError() ë©”ì„œë“œì—ì„œ ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ ë©”ì¼ì„
    ë³´ë‚´ëŠ” ë“±ì˜ ë¶€ê°€ì ì¸ ì¼ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

## JobExecutionListener ì™€ ExecutionContext ë¥¼ í™œìš©í•œ ë™ì  ë°ì´í„° ì „ë‹¬

- ì¡ íŒŒë¼ë¯¸í„° ë§Œìœ¼ë¡œëŠ” ì „ë‹¬í•  ìˆ˜ ì—†ëŠ” ë™ì  ë°ì´í„°ê°€ í•„ìš”í•œ ê²½ìš°
- `JobExecutionListener` ì˜ `beforeJob()` ë©”ì„œë“œë¥¼ í™œìš©í•˜ë©´ ì¶”ê°€ì ì¸ ë™ì  ë°ì´í„°ë¥¼ ê° Step ì— ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
- [AdvancedSystemInfiltrationConfig](./AdvancedSystemInfiltrationConfig.java)
- [InfiltrationPlanListener](./InfiltrationPlanListener.java)


- ì˜ˆì œ ì‹¤í–‰

```shell
./gradlew bootRun --args='--spring.batch.job.name=systemInfiltrationJob'
```

### ì™œ JobParameters ê°€ ì•„ë‹Œ ExecutionContext ë¥¼ ì‚¬ìš©í• ê¹Œ?

í•œ ë²ˆ ìƒì„±ëœ JobParameters ëŠ” ë³€ê²½í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

- Spring Batch ì˜ í•µì‹¬ ì² í•™ ì¤‘ í•˜ë‚˜ëŠ” ë°°ì¹˜ ì‘ì—…ì˜ **ì¬í˜„ ê°€ëŠ¥ì„±(Repeatability)**ê³¼ **ì¼ê´€ì„±(Consistency)**ë¥¼ ë³´ì¥í•˜ëŠ” ê²ƒ
- ì´ë¥¼ ìœ„í•˜ì—¬ **JobParameters** ëŠ” ë¶ˆë³€(immutable) í•˜ê²Œ ì„¤ê³„ë˜ì—ˆë‹¤.
  - **ì¬í˜„ ê°€ëŠ¥ì„±**: ë™ì¼í•œ JobParameters ë¡œ ì‹¤í–‰í•œ Job ì€ í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ìƒì„±í•œë‹¤. ì‹¤í–‰ ì¤‘ê°„ì— JobParameters ê°€ ë³€ê²½ë˜ë©´ ì´ë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤.
  - **ì¶”ì  ê°€ëŠ¥ì„±**: ë°°ì¹˜ ì‘ì—…ì˜ ì‹¤í–‰ ê¸°ë¡(JobInstance, JobExecution) ê³¼ JobParameters ëŠ” ë©”íƒ€ë°ì´í„° ì €ì¥ì†Œì— ì €ì¥ëœë‹¤. JobParameters ê¸°ë¡ê³¼ ì‹¤ì œ ì‘ì—…ì˜ ë¶ˆì¼ì¹˜ê°€
    ë°œìƒí•  ìˆ˜ ìˆë‹¤.

> [ì‹œìŠ¤í…œ ê²½ê³ ]  
> JobExecutionListener ì™€ ExecutionContext ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì€ ë¶„ëª… ìœ ìš©í•  ìˆ˜ ìˆì§€ë§Œ,  
> JobParameters ë§Œìœ¼ë¡œ ì¶©ë¶„íˆ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ê²½ìš°ì—ë„, ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ìœ í˜¹ì— ë¹ ì§€ê¸° ì‰½ë‹¤.
>
> **ì˜ëª»ëœ ì½”ë“œ, ì´ë ‡ê²Œ ì‘ì„±í•˜ì§€ ë§ˆë¼ğŸ’€**
> ```java
> // ì´ëŸ° ì½”ë“œì— í˜„í˜¹ë˜ì§€ ë§ˆë¼
> @Override
> public void beforeJob(JobExecution jobExecution) {
>   jobExecution.getExecutionContext()
>       .put("targetDate", LocalDate.now()); // ì¹˜ëª…ì ì¸ ì‹¤ìˆ˜ë‹¤
> }
> ```
> ì´ ë°©ì‹ì˜ ë¬¸ì œì ì€ ë¬´ì—‡ì¼ê¹Œ?
> - ì–´ì œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì²˜ë¦¬í•˜ê³  ì‹¶ìœ¼ë©´? ë¶ˆê°€ëŠ¥í•˜ë‹¤. í”„ë¡œê·¸ë¨ì„ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ ê·¸ë‚ ì˜ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤.
>
> ê²°êµ­ í•˜ë“œì½”ë”©ëœ ë°©ì‹ì€ ë°°ì¹˜ì˜ ìœ ì—°ì„±ì„ ë–¨ì–´ëœ¨ë¦¬ê³ , í•„ìš”í•œ ìˆœê°„ì— ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ê²Œ ë§Œë“ ë‹¤.
>
> ëŒ€ì‹  ì´ë ‡ê²Œ í•˜ë¼ğŸ’€  
> **ì™¸ë¶€ì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ë¼**
> ```shell
> ./gradlew bootRun --args='--spring.batch.job.name=systemInfiltrationJob -date=2024-10-13'
> ```
> ì´ë ‡ê²Œ ì™¸ë¶€ì—ì„œ ë‚ ì§œ ê°’ì„ ì „ë‹¬ë°›ìœ¼ë©´, ë°°ì¹˜ ì‘ì—…ì˜ ìœ ì—°ì„±ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆë‹¤. JobParametersëŠ” ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë¥¼ ì™¸ë¶€ì—ì„œ ë°›ì„ ìˆ˜ ìˆëŠ” í›Œë¥­í•œ ë°©ë²•ì´ë‹¤.
>
> JobParametersë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ë©´ ê·¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ë¼. ì™¸ë¶€ì—ì„œ ê°’ì„ ë°›ëŠ” ê²ƒì´ í›¨ì”¬ ë” ì•ˆì „í•˜ê³  ìœ ì—°í•˜ë‹¤. JobExecutionListenerì™€ ExecutionContextëŠ” ì™¸ë¶€ì—ì„œ ê°’ì„ ë°›ì„
> ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ì.

- Step ìˆ˜ì¤€ ExecutionContext ì— ì €ì¥ëœ ë°ì´í„°ëŠ” í•´ë‹¹ Step ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë¯€ë¡œ ë‹¤ë¥¸ Step ê³¼ ê³µìœ ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- ê·¸ë˜ì„œ í•œ Step ì˜ ExecutionContext ì— ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ë‹¤ìŒ Step ì—ê²Œ ì „ë‹¬í•˜ë ¤ë©´ Step ì˜ ExecutionContext ì˜ ê°’ì„ ê°€ì ¸ì™€ ì´ë¥¼ Job ìˆ˜ì¤€ ExecutionContext
  ì— ì§ì ‘ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
- **ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœ**
  ```java
  StepExecution stepExecution = contribution.getStepExecution();
  ExecutionContext stepExecutionContext = stepExecution.getExecutionContext();
  Integer infiltrationCount = (Integer) stepExecutionContext.get("infiltrationCount");
  
  JobExecution jobExecution = stepExecution.getJobExecution();
  jobExecution.getExecutionContext.put("totalInfiltrations",infiltrationCount);
  ```
- Spring Batch ëŠ” ì´ëŸ° ë°˜ë³µì ì¸ ë¶ˆí¸í•œ ê³¼ì •ì„ ì•Œì•„ì„œ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ìˆë„ë¡ `ExecutionContextPromotionListener` ë¼ëŠ” StepExecutionListener êµ¬í˜„ì²´ë¥¼ ì œê³µí•œë‹¤.
- `ExecutionContextPromotionListener` ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì™€ ê°™ì´ ë²ˆê±°ë¡œìš´ ì‘ì—…ì´ ì—†ì´ë„ ì†ì‰½ê²Œ ìŠ¤í… ê°„ ë°ì´í„° ê³µìœ ê°€ ê°€ëŠ¥í•˜ë‹¤

## ExecutionContextPromotionListener ë¥¼ í™œìš©í•œ Step ê°„ ë°ì´í„° ê³µìœ 

`ExecutionContextPromotionListener` ëŠ” `Step` ìˆ˜ì¤€ `ExecutionContext` ì˜ ë°ì´í„°ë¥¼ `Job` ìˆ˜ì¤€ `ExecutionContext` ë¡œ ë“±ë¡ì‹œì¼œì£¼ëŠ”
`StepExecutionListener` ì˜ êµ¬í˜„ì²´ì´ë‹¤.

> Spring Batch ì—ì„œëŠ” Step ìˆ˜ì¤€ì˜ ExecutionContext ë°ì´í„°ë¥¼ Job ìˆ˜ì¤€ì˜ ExecutionContext ë¡œ ì˜®ê¸°ëŠ” ê³¼ì •ì„ ìŠ¹ê²©(Promote) ì´ë¼ ë¶€ë¥¸ë‹¤.
> ì´ ë¦¬ìŠ¤ë„ˆëŠ” StepExecutionListener ì˜ afterStep() ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ìŠ¹ê²© ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

```java
import org.springframework.batch.core.listener.ExecutionContextPromotionListener;
import org.springframework.context.annotation.Bean;

@Bean
public ExecutionContextPromotionListener promotionListener() {
  ExecutionContextPromotionListener listener = new ExecutionContextPromotionListener();
  listener.setKeys(new String[]{"targetSystem"});
  return listener;
}
```

1. ë¨¼ì € `ExecutionContextPromotionListener` ì—ëŠ” Step ìˆ˜ì¤€ì˜ ExecutionContext ì—ì„œ Job ìˆ˜ì¤€ìœ¼ë¡œ ìŠ¹ê²©í•  ë°ì´í„°ì˜ **Key** ê°’ì„ ì§€ì •í•´ì£¼ì–´ì•¼ í•œë‹¤. ì´ëŠ”
   `setKeys()` ë©”ì„œë“œë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
2. ì´ë ‡ê²Œ ìƒì„±í•œ `promotionListener` ë¥¼ Step ì˜ ë¦¬ìŠ¤ë„ˆë¡œ ë“±ë¡í•œë‹¤.
3. ì´ë ‡ê²Œí•˜ë©´ Step ìˆ˜ì¤€ì˜ ExecutionContext ë°ì´í„°ê°€ Job ìˆ˜ì¤€ì˜ ExecutionContext ë¡œ ìŠ¹ê²©ë˜ì–´, ë‹¤ìŒ ìŠ¤í…ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
    ```java
    @StepScope
    public Tasklet eliminationTasklet(
        // Jobì˜ ExecutionContextì—ì„œ ê°’ ì¡°íšŒ
        @Value("#{jobExecutionContext['targetSystem']}") String target
    ) {
      return (contribution, chunkContext) -> {
        log.info("ì‹œìŠ¤í…œ ì œê±° ì‘ì—… ì‹¤í–‰: {}", target);
        return RepeatStatus.FINISHED;
      };
    }
    ```

## Listener ì™€ @JobScope, @StepScope í†µí•©

- ë¦¬ìŠ¤ë„ˆì™€ Spring Batch Scope ë¥¼ í†µí•©í•˜ë©´ ë¦¬ìŠ¤ë„ˆì—ì„œ ì¡ íŒŒë¼ë¯¸í„°ë¥¼ ë§¤ìš° ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.
- ì´ë¥¼ í†µí•´ ì‹¤í–‰ ì‹œì ì— ê²°ì •ë˜ëŠ” ê°’ë“¤ì„ ë¦¬ìŠ¤ë„ˆë‚´ì—ì„œë„ í™œìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ë§ì´ë‹¤.
- [SystemDestructionConfig_3](SystemDestructionConfig_3.java)

---

## Listener ë§ˆì§€ë§‰ í›ˆë ¨: ì„±ëŠ¥ê³¼ ëª¨ë²” ì‚¬ë¡€

**ë¦¬ìŠ¤ë„ˆë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ë²•**

1. ë¬´ê¸° ì„ íƒì˜ ì •í™•ì„±

- `JobExecutionListener`: ì „ì²´ ì‘ì „ì˜ ì‹œì‘ê³¼ ì¢…ë£Œë¥¼ í†µì œ
- `StepExecutionListener`: ê° ì‘ì „ ë‹¨ê³„ì˜ ì‹¤í–‰ì„ ê°ì‹œ
- `ChunkListener`: ì‹œìŠ¤í…œì„ ì²­í¬ë‹¨ìœ„ë¡œ ì œê±°í•  ë•Œ, ë°˜ë³µì˜ ì‹œì‘ê³¼ ì¢…ë£Œ ì‹œì ì„ í†µì œ
- `Item[Read|Process|Write]Listener`: ê°œë³„ ì•„ì´í…œ ì‹ë³„ í†µì œ

2. ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ì‹ ì¤‘í•˜ê²Œ  
   `JobExecutionListener` ì˜ `beforeJob()`ê³¼ StepExecutionListenerì˜ `beforeStep()` ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ Job ê³¼ Step ì´ ì‹¤íŒ¨í•œ ê²ƒìœ¼ë¡œ
   íŒë‹¨ëœë‹¤.  
   í•˜ì§€ë§Œ ëª¨ë“  ì˜ˆì™¸ê°€ Step ì„ ì¤‘ë‹¨ì‹œì¼œì•¼ í•  ë§Œí¼ ì¹˜ëª…ì ì¸ ê²ƒì€ ì•„ë‹ˆë‹¤. ì´ëŸ° ê²½ìš°ëŠ” ì§ì ‘ ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ë¬´ì‹œí•˜ê³  ì§„í–‰í•˜ëŠ” ê²ƒì´ í˜„ëª…í•˜ë‹¤.
   > â˜ ï¸ [ì‹œìŠ¤í…œ ì¸í…”ë¦¬ì „ìŠ¤]  
   > ë°˜ë©´, `JobExecutionListener.afterJob()`ê³¼ `StepExecutionListener.afterStep()`ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ëŠ” ë¬´ì‹œëœë‹¤.  
   > ì¦‰, ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ Jobê³¼ Step ì˜ ì‹¤í–‰ ê²°ê³¼ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§„ ì•ŠëŠ”ë‹¤.

    ```java
    @Override
    public void beforeStep(StepExecution stepExecution) {
      try {
        // ì¹˜ëª…ì ì¸ ë¡œì§ ìˆ˜í–‰
        systemMetricCollctor.collect();
      } catch (Exception e) {
        // ì‹¬ê°í•˜ì§€ ì•Šì€ ì˜ˆì™¸ëŠ” ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ì§„í–‰
        log.warn("ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹¤íŒ¨. ì‘ì „ì€ ê³„ì† ì§„í–‰: {}", e.getMessage());
        // ì •ë§ ì‹¬ê°í•œ ë¬¸ì œë©´ ì˜ˆì™¸ë¥¼ ë˜ì ¸ì„œ Step ì„ ì¤‘ë‹¨ì‹œí‚¨ë‹¤.
        // throw new RuntimeException("ì¹˜ëª…ì  ì˜¤ë¥˜ ë°œìƒ", e);
      }
    }
    ```

3. ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜

- ë¦¬ìŠ¤ë„ˆëŠ” ê°ì‹œì™€ í†µì œë§Œ ë‹´ë‹¹í•œë‹¤.
- ì‹¤ì œ ì‹œìŠ¤í…œ ì œê±° ë¡œì§(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)ì€ ë¶„ë¦¬í•˜ë¼
- ë¦¬ìŠ¤ë„ˆê°€ ë„ˆë¬´ ë§ì€ ì¼ì„ í•˜ë©´ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì§€ê³  ì‹œìŠ¤í…œ ë™ì‘ì„ íŒŒì•…í•˜ê¸° í˜ë“¤ë‹¤.

---

## ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ê²½ê³ 

1. ì‹¤í–‰ ë¹ˆë„ë¥¼ ê³ ë ¤í•˜ë¼

- `JobExecutionListener`/`StepExecutionListener`
  - Job, Step ì‹¤í–‰ë‹¹ í•œ ë²ˆì”©ë§Œ ì‹¤í–‰ë˜ë¯€ë¡œ ë¹„êµì  ì•ˆì „í•˜ë‹¤.
  - ë¬´ê±°ìš´ ë¡œì§ì´ ë“¤ì–´ê°€ë„ ì „ì²´ ì„±ëŠ¥ì— í° ì˜í–¥ ì—†ìŒ
- `ItemReadListener`/`ItemProcessListener`
  - ë§¤ ì•„ì´í…œë§ˆë‹¤ ì‹¤í–‰ë˜ë¯€ë¡œ ì¹˜ëª…ì ì¼ ìˆ˜ ìˆë‹¤.

  ```java
  // ì´ëŸ°ì‹ì˜ ì½”ë“œëŠ” ì‹œìŠ¤í…œì„ ë§ˆë¹„ì‹œí‚¬ ìˆ˜ ìˆìŒ
  @Override
  public void afterRead(Object item) {
    heavyOperation(); // ë§¤ ì•„ì´í…œë§ˆë‹¤ ì‹¤í–‰ë˜ë©´ ì‹œìŠ¤í…œì´ ë§ˆë¹„ë¨
    removeApiCall(); // ì™¸ë¶€ API í˜¸ì¶œì€ ë”ë”ìš± ìœ„í—˜
  }
  ```

2. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì„ ìµœì†Œí™”í•˜ë¼

- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, íŒŒì¼ I/O, ì™¸ë¶€ API í˜¸ì¶œì€ ìµœì†Œí™”
- ë¦¬ìŠ¤ë„ˆ ë‚´ ë¡œì§ì€ ê°€ëŠ¥í•œ ê°€ë³ê²Œ ìœ ì§€
- íŠ¹íˆ Item ë‹¨ìœ„ ë¦¬ìŠ¤ë„ˆì—ì„œëŠ” ë”ìš± ì¤‘ìš”